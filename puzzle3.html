<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🌟《宇宙で一番優しい音》第3話 光の迷宮</title>
  <link rel="stylesheet" href="css/common.css" />
</head>
<body>
  <canvas id="stars"></canvas>

  <div class="container">
    <h1>🌟《宇宙で一番優しい音》第3話　光の迷宮</h1>

    <div class="story">
      <p>前夜の謎を解き明かした翌朝。<br>
      コナンたちのもとに、再び白いハトが現れた。</p>

      <p>その足に結ばれた銀色の封筒には、光のように反射するインクでこう書かれていた。</p>
      <p>「次の宝は、“光の道”の奥にある。」</p>
    </div>

    <!-- 🕵️ Scene 1：KAGRAの通路 -->
    <div class="scene-visual" style="background-image:url('images/bg_kagra_tunnel.jpg');">
      <div class="dialogue right">
        <img src="images/haibara.png" alt="灰原" class="char-face">
        <div class="speech">
          <div class="char-name haibara">灰原</div>
          <p><em>まるで……迷路ね。</em></p>
        </div>
      </div>

      <div class="dialogue left">
        <img src="images/conan.png" alt="コナン" class="char-face">
        <div class="speech">
          <div class="char-name conan">コナン</div>
          <p><em>いや、これは“光の迷宮”。施設の中を走る光の経路を示している。</em></p>
        </div>
      </div>
    </div>

    <!-- 📜 謎の図 -->
    <div class="puzzle-image">
      <img src="images/puzzle3_jp_main.png" alt="光の道と鏡が描かれた謎の図" />
    </div>

    <div class="scene-visual" style="background-image:url('images/bg_lab_discussion.jpg');">
      <div class="dialogue left">
        <img src="images/agasa.png" alt="阿笠博士" class="char-face">
        <div class="speech">
          <div class="char-name agasa">阿笠博士</div>
          <p><em>うむむ……鏡に当たって反射してるようじゃが、どこへ行くのかさっぱり分からん！</em></p>
        </div>
      </div>

      <div class="dialogue right">
        <img src="images/mitsuhiko.png" alt="光彦" class="char-face">
        <div class="speech">
          <div class="char-name mitsuhiko">光彦</div>
          <p><em>矢印がバラバラで、ゴールもないように見えます！</em></p>
        </div>
      </div>

      <div class="dialogue left">
        <img src="images/conan.png" alt="コナン" class="char-face">
        <div class="speech">
          <div class="char-name conan">コナン</div>
          <p><em>つまり――これは“ルールを知らないと解けない謎”ってわけだ。</em></p>
        </div>
      </div>
    </div>

    <!-- 📘 光学ルール説明 -->
    <div class="puzzle-image">
      <img src="images/puzzle3_jp_rule.png" alt="光線の反射とビームスプリッターの説明図"
      style="max-width: 80%; height: auto; display: block; margin: 0 auto;" />
    </div>

    <div class="scene-visual" style="background-image:url('images/bg_optics_board.jpg');">
      <div class="dialogue left">
        <img src="images/conan.png" alt="コナン" class="char-face">
        <div class="speech">
          <div class="char-name conan">コナン</div>
          <p><em>この装置の中では、光が鏡や“ビームスプリッター”に当たることで進む道が決まる。<br>
          この素子は“半分反射・半分透過”する仕組みなんだ。</em></p>
        </div>
      </div>
    </div>

    <div class="optics-rules">
      <h2>🌟 光学素子と光の動きのルールまとめ</h2>
      <ul>
        <li>🟥 <strong>光線（赤線）</strong><br>
          光が進む道を表す。矢印の方向に進む。<br>
          鏡やビームスプリッターに当たると進路が変わる。
        </li>
        <li>🪞 <strong>鏡（Mirror）</strong><br>
          光を反射する。入射角 = 反射角 の法則に従う。
        </li>
        <li>🔷 <strong>ビームスプリッター（Beam Splitter）</strong><br>
          半透過鏡。光を二つの道に分ける。<br>
          一部は透過し、一部は反射して別方向へ進む。
        </li>
        <li>⬛ <strong>黒い四角（停止点）</strong><br>
          光が当たると止まる。反射もしない。
        </li>
      </ul>
    </div>

    <div class="scene-visual" style="background-image:url('images/bg_optics_reflect.jpg');">
      <div class="dialogue right">
        <img src="images/haibara.png" alt="灰原" class="char-face">
        <div class="speech">
          <div class="char-name haibara">灰原</div>
          <p><em>つまり、この“光の動き”を正しく追えば、答えが出るということね。</em></p>
        </div>
      </div>

      <div class="dialogue left">
        <img src="images/conan.png" alt="コナン" class="char-face">
        <div class="speech">
          <div class="char-name conan">コナン</div>
          <p><em>ああ――“真実の光”が導く言葉が、キッドの狙いだ。</em></p>
        </div>
      </div>
    </div>

    <!-- 🔍 入力欄 -->
    <div class="controls">
      <input type="text" id="answer" placeholder="答えを入力してください…" />
      <button class="btn btn-primary" onclick="checkAnswer3()">送信</button>
      <button class="btn btn-hint" onclick="showHint3()">ヒント</button>
      <button class="btn btn-answer" onclick="showAnswer3()">答えを見る</button>
    </div>

    <p id="message"></p>
    <p id="hint" class="hint"></p>

    <!-- ✅ 解説（正解後表示） -->
    <div id="explanation" class="explain" style="display:none;">
      <div class="puzzle-image"> <img src="images/puzzle3_jp_answer.png" alt="LASERの答え図" /> </div>
      <div class="scene-visual" style="background-image:url('images/bg_lightbeam.jpg');">
        <div class="dialogue left">
          <img src="images/conan.png" alt="コナン" class="char-face">
          <div class="speech">
            <div class="char-name conan">コナン</div>
            <p>赤い線をたどっていくと……文字が現れていく……L → A → S → E → R！</p>
          </div>
        </div>

        <div class="dialogue right">
          <img src="images/haibara.png" alt="灰原" class="char-face">
          <div class="speech">
            <div class="char-name haibara">灰原</div>
            <p>LASER……！</p>
          </div>
        </div>

        <div class="dialogue left">
          <img src="images/agasa.png" alt="阿笠博士" class="char-face">
          <div class="speech">
            <div class="char-name agasa">阿笠博士</div>
            <p>そうか！ 光を増幅し、干渉させて距離の変化を測る装置……まさにこの施設の心臓部じゃ！</p>
          </div>
        </div>

        <div class="dialogue right">
          <img src="images/conan.png" alt="コナン" class="char-face">
          <div class="speech">
            <div class="char-name conan">コナン</div>
            <p>キッドの言う“光の道”は、レーザーそのものを指していたんだ。</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 🌙 エンディング -->
    <div id="ending" style="display:none;">
      <p>天井の反射光が集まり、白いマントの影が現れた。</p>
      <div class="scene-visual" style="background-image:url('images/bg_laser_reflect.jpg');">
        <div class="dialogue left">
          <img src="images/kid.png" alt="怪盗キッド" class="char-face">
          <div class="speech">
            <div class="char-name kid">怪盗キッド</div>
            <p>お見事、探偵くん。光の迷宮を抜けたようだね。</p>
          </div>
        </div>

        <div class="dialogue right">
          <img src="images/conan.png" alt="コナン" class="char-face">
          <div class="speech">
            <div class="char-name conan">コナン</div>
            <p>だが――光がある限り、影もまた生まれる。</p>
          </div>
        </div>

        <div class="dialogue left">
          <img src="images/kid.png" alt="怪盗キッド" class="char-face">
          <div class="speech">
            <div class="char-name kid">怪盗キッド</div>
            <p>フフ、月明かりの下で会おう。――光と影の交わる場所で。</p>
          </div>
        </div>
      </div>

      <div class="next">
        <a href="puzzle4.html">▶ 第4話へ：消える光の謎</a>
      </div>
    </div>
  </div>

  <script src="js/common.js"></script>
  <script>
    // ==== Puzzle 3 専用スクリプト ====
    const hints3 = [
      "💡 ヒント①：赤い線は“光”を表している。鏡に当たると反射し、ビームスプリッターでは２方向に進む。<br>光の進路を目で追ってみよう。",
      "📘 ヒント②：分かれた光をよく見ると、文字のような形が現れはじめる……。",
      "🌙 ヒント③：途中までの進路は下のように見えてくる。<br><br><img src='images/puzzle3_jp_hint.png' alt='puzzle3途中図' style='max-width:90%;border:1px solid #44aaff;border-radius:8px;margin:10px 0;'><br>“光を増幅して干渉させる装置”――この続きを完成させよう！"
    ];

    function showHint3() {
      showHint(hints3);
    }

    function checkAnswer3() {
      const input = document.getElementById("answer").value.trim().toUpperCase();
      const msg = document.getElementById("message");
      if (!input) {
        msg.style.color = "#ccc";
        msg.textContent = "答えを入力してください。";
        return;
      }
      if (["LASER"].includes(input)) {
        msg.style.color = "#00ffcc";
        msg.textContent = "🎉 正解！ 光の迷宮を抜けた！";
        setTimeout(revealExplanation, 1000);
      } else {
        msg.style.color = "#ff6666";
        msg.textContent = "残念…もう一度考えてみよう。";
      }
    }

    function showAnswer3() {
      kidReveal([
        "🎩『フッ……光の道を追えたかな？』",
        "💡『L・A・S・E・R――“光を増幅する真実の道”。』",
        "🌙『LASER、それがこの施設の心臓部だ。』"
      ]);
    }
  </script>
</body>
</html>

